---
title: "Tema 01 - Visualización de Datos"
subtitle: "Ejercicio Práctico"
author:  
    - "Pedro Albarrán"
    - "Alberto Pérez"
institute: "Dpto. de Fundamentos del Análisis Económico. Universidad de Alicante"
format:
  html: 
    embed-resources: true
    toc: true
    toc-depth: 3
    theme: cosmo
    css: styles.css
execute:
  enabled: true
  eval: false
  echo: true
  warning: false
  message: false
lang: es
strip-comments: true
---

```{r setup}
#| include: false
knitr::opts_chunk$set(eval = FALSE, echo = TRUE, 
                      warning = FALSE, message = FALSE,
                      results = "hide", fig.show="hide")
rm(list = ls())       
library(tidyverse)
library(rio)
library(kableExtra)
library(ggrepel)
library(scales)
library(rmarkdown)
```

```{r}
#| echo: false
#| eval: false
library(pwt10)
library(countrycode)
library(rio)
pwt <- pwt10.01

pwt$continent <- countrycode(pwt$isocode, origin = 'iso3c', destination = 'continent')
export(pwt, file = "/home/albarran/Archivos/teaching/MAD/000/00datos/pwt.csv")
export(pwt, file = "data/pwt.csv")

```

<!--

# Instrucciones Generales

Este ejercicio tiene como objetivo aplicar los conceptos de visualización de datos con `ggplot2` a casos reales de análisis económico y empresarial. 

**Importante**: 
- Crea un proyecto de RStudio para organizar tu trabajo
- Todos los gráficos deben incluir títulos, etiquetas de ejes y leyendas apropiadas
- Comenta brevemente la información que revela cada visualización
- Guarda tu código en un archivo `.R` siguiendo el formato: `Tema01ej_TuDNI.R`

---
-->

**NOTA**: todos los comentarios sobre los resultados se incluyen en el propio archivo de guión.

## Ejercicio 1

El fichero [pwt.csv](https://raw.githubusercontent.com/albarran/00datos/main/pwt.csv) contiene datos de las Penn World Tables (PWT) más una variable de continente. Las descripción de las variables de las PWT se puede encontrar [aquí](https://cran.r-project.org/web/packages/pwt10/pwt10.pdf)


### Apartado 1.a)

Usando otras **DOS variables económicas** que tengan sentido relacionar, debes reproducir aproximadamente [este gráfico](http://www.economist.com/node/21541178) de The Economist sobre Corrupción y Desarrollo Humano:

<center>
![](figure/Economist1.png)
</center>

- Sugerencias de pares de variables:

  - Capital humano (`hc`) vs Productividad (`rtfpna`)
  
  - PIB per cápita (`rgdpna`) vs Esperanza de vida (`pop`)
  
  - Formación de capital (`csh_i`) vs Crecimiento
  
- *Nota*: este es un **ejercicio individual**. Se recomienda evitar el uso de las mismas variables y/o ofrecer resultados y comentarios demasiado similares.

- *Requisitos:*

  - Usa datos de **un solo año**
  
  - Incluye puntos coloreados por continente
  
  - Añade línea de tendencia
  
  - Etiqueta algunos países seleccionados
  
  - La reproducción es aproximada (no necesitas puntos vacíos o R²)

### Apartado 1.b)

Comenta **brevemente** qué información revela tu gráfico. 



---

## Ejercicio 2

Una consultora de inversiones quiere comparar el perfil de ingresos obtenidos entre startups tecnológicas y grandes corporaciones para una estrategia de inversión.

```{r datos-ventas}
#| echo: false
#| eval: true
#| results: 'asis'

library(kableExtra)

# Datos de ingresos: Startups vs Corporaciones
empresas_inversion <- data.frame(
  empresa = c("Google", "Microsoft", "Apple", "Amazon", "Meta",
              "TechStart", "InnovateLab", "DataFlow", "CloudVision", "AI-Solutions"),
  tipo = c("Corporación", "Corporación", "Corporación", "Corporación", "Corporación",
           "Startup", "Startup", "Startup", "Startup", "Startup"),
  ingresos_millones = c(3522.91, 2831.89, 2413.98, 1751.65, 1187.63,
                       81.40, 62.83, 37.21, 15.80, 8.45),
  empleados = c(85000, 72000, 65000, 48000, 35000,
               120, 85, 45, 28, 15)
)

empresas_inversion |> 
  kbl(format = "html", caption = "Ingresos y Empleados: Corporaciones vs Startups (2023)") |> 
  kable_paper("hover", full_width = FALSE) 
```

### Apartado 2.a)

Mostrar dos diagramas de caja de la distribución de ingresos por tipo de empresa, sin usar y usando escala logarítmica. 

  -  Nota: realizar algunos ajustes (mínimos) a los gráficos como dar color a los diagramas (asociado al tipo de empresa), poner título al gráfico, los ejes, etc.

### Apartado 2.b)

- Comparando ambos gráficos, ¿qué diferencias existen en la posición central y la variabilidad dentro de cada grupo? ¿qué explican esas diferencias?
  
- ¿Qué gráfico es más informativo y por qué?
  
- Si la variabilidad observada en los gráficos es una aproximación de la variabilidad en la rentabilidad de una inversión, ¿qué concluirías como empleado de la consultora sobre si es más volátil invertir en Corporaciones o en Startups?
  

---

## Ejercicio 3


El fichero [hotels.csv](https://raw.githubusercontent.com/albarran/00datos/main/hotels.csv) contiene información sobre reservas de hoteles, donde cada fila corresponde con una reserva; la información detallada sobre las variables puede encontrarse [aquí](https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-02-11/readme.md). 

<!-- https://medium.com/@AnalystEmelda/using-data-visualizations-to-support-marketing-strategies-a50c807c10bb -->


```{r}
#| echo: false
#| results: 'asis'

library(rio)

datos <- import("https://raw.githubusercontent.com/albarran/00datos/main/hotels.csv")

ggplot (data = datos) + geom_bar (mapping = aes (x=market_segment)) + facet_wrap(~hotel)
```

### Apartado 3.a)

La columna `market_segment` contiene información de a qué categoría de los segmentos de mercado pertenece la reserva: Aviation (reservas por aerolíneas), Complementary (reservas de cortesía/gratuitas), Corporate (reservas de Empresas), Direct (reservas directas), Groups (Grupos), Offline TA/TO (Agencia de Viajes/Tour Operador 'offline'), Online TA (Agencia de Viajes de internet), Undefined (Sin definir). <!-- Podemos representar la distribución de reservas en cada segmento de la siguiente manera: 

```{r}
#| echo: true
#| results: 'asis'
# suponiendo que los datos están en un data frame llamado datos
ggplot (data = datos) + geom_bar (mapping = aes (x=market_segment))
```
-->

Una cadena hotelera está interesada en desarrollar promociones basadas en diferentes segmentos de mercado. Pero primero necesita saber cuántas de las transacciones ocurren para cada segmento de mercado y si esto dependía del tipo de hotel. La variable `hotel` indica el tipo de hotel: `City Hotel` (hotel urbano) o `Resort Hotel` (hotel de vacaciones). 

Mostrar una visualización que permita a la cadena hotelera tener la información para tomar decisiones sobre sus promociones. Realizar los ajustes necesarios para que la visualización sea clara y fácil de interpretar: títulos, etiquetas, colores, etc.

### Apartado 3.b)

Un directivo de la empresa afirma que deben centrarse en personas que reservan con antelación, y cree que las personas con hijos tienden a reservar con mayor anticipación. Realice un análisis que permita comprobar si esta afirmación es cierta o no. 

Nota: para realizar este análisis, se puede usar la variable `lead_time` (número de días que transcurren entre la fecha de reserva y la fecha de llegada) y la variable `children` (número de niños).

<!--

Una agencia de marketing digital ha recopilado datos sobre campañas publicitarias:

```{r datos-marketing}
#| echo: false
#| eval: true
# Los datos estarán disponibles en:
# marketing_data <- rio::import("https://raw.githubusercontent.com/albarran/00datos/main/marketing_campaigns.csv")
```

Los datos incluyen: `campaña`, `canal` (Google, Facebook, Instagram, LinkedIn), `presupuesto`, `impresiones`, `clics`, `conversiones`, `fecha`, `sector_cliente` (Tecnología, Retail, Servicios, Manufactura).

Para cada pregunta de negocio, **especifica y justifica** qué tipo de gráfico usarías, luego **créalo**:

### Pregunta 3a: Efectividad por Canal
"¿Qué canal publicitario tiene mejor tasa de conversión?"

**Tu propuesta de gráfico:** _______________
**Justificación:** _______________

### Pregunta 3b: Evolución Temporal
"¿Cómo ha evolucionado el ROI (retorno de inversión) por sector durante el último año?"

**Tu propuesta de gráfico:** _______________
**Justificación:** _______________

### Pregunta 3c: Relación Presupuesto-Resultados
"¿Existe relación entre el presupuesto y el número de conversiones? ¿Depende del sector?"

**Tu propuesta de gráfico:** _______________
**Justificación:** _______________

### Pregunta 3d: Comparación de Performance
"¿Qué combinación canal-sector genera mejores resultados en términos de costo por conversión?"

**Tu propuesta de gráfico:** _______________
**Justificación:** _______________

---

## Ejercicio 4: Análisis de Satisfacción del Cliente

Una cadena de retail quiere entender los factores que influyen en la satisfacción del cliente:

```{r datos-satisfaccion}
#| echo: false
#| eval: true
# Datos disponibles en:
# satisfaccion <- rio::import("https://raw.githubusercontent.com/albarran/00datos/main/customer_satisfaction.csv")
```

Variables: `tienda`, `region`, `categoria_producto`, `precio`, `tiempo_espera`, `calidad_servicio`, `satisfaccion_general`, `probabilidad_recompra`, `edad_cliente`, `genero`.

### Apartado 4a: Factores de Satisfacción
Identifica qué variables están más relacionadas con la satisfacción general. Crea las visualizaciones apropiadas y explica tus hallazgos.

### Apartado 4b: Segmentación Regional
Analiza si existen diferencias significativas en satisfacción entre regiones y categorías de producto. ¿Qué estrategias regionales recomendarías?

-->

# Entrega del ejercicio

Rellenad este [FORMULARIO](https://docs.google.com/forms/d/e/1FAIpQLSccdbd-7YhwJ2jSEEYbu9tWg4cjkw2run1wBioaiza5B-f6kQ/viewform) con vuestros datos y subid 

  * vuestro archivo de R 

IMPORTANTE: el nombre de los ficheros que subáis DEBE  seguir el  siguiente formato que incluye vuestro número de DNI: ej.,

 * Tema01ej_123456789.R
  
